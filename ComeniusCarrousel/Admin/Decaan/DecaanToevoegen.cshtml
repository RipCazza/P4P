@*
    Permissies: Admin
    Te bereiken van: Admin/Decaan/DecaanOverzicht
    Linkt door naar: Admin/Decaan/DecaanOverzicht
    Beschrijving: Vraagt om een mail en wachtwoord en voegt hiermee een gebruiker toe aan de database met decaan permissies
*@
@{
    Layout = "~/_Layout.cshtml";
    Page.Title = "Decaan toevoegen";

    if (!User.IsInRole("Admin"))
    {
        Response.Redirect("~/");
    }

    var userName = "";
    var password = "";
    var confirmPassword = "";

    Validation.RequireField("userName", "U moet een gebruiker invullen.");
    Validation.RequireField("password", "Er moet een wachtwoord ingevuld worden.");
    Validation.RequireField("confirmPassword", "Bevestigingswachtwoord mag niet leeg zijn.");

    Validation.Add("confirmPassword",
        Validator.EqualsTo("password", "Bevestigingswachtwoord komt niet overeen met het wachtwoord."));
    Validation.Add("password",
        Validator.StringLength(
            maxLength: Int32.MaxValue,
            minLength: 6,
            errorMessage: "Wachtwoord moet minstens 6 tekens bevatten"));
    Validation.Add("userName",
        Validator.StringLength(
            maxLength: 400,
            errorMessage: "gebruiker kan niet meer dan 400 tekens bevatten"));

    if(IsPost)
    {
        AntiForgery.Validate();
        userName = Request.Form["userName"];
        password = Request.Form["password"];
        confirmPassword = Request.Form["confirmPassword"];

        if(Validation.IsValid())
        {
            DecaanRepo.MakeDecaan(userName, password);
            Response.Redirect("~/Admin/Decaan/DecaanOverzicht");
        }
    }
}

<h2>Nieuwe decaan aanmaken</h2>

<div class="col-md-12">
    <form method="post">
        @AntiForgery.GetHtml()
        @Html.ValidationSummary("Account creatie is mislukt, verhelp de fouten en probeer het opnieuw.", excludeFieldErrors: true, htmlAttributes: null)
        <fieldset>
            <div class="form-group">
                <label for="userName">Email adres</label>
                <input type="text" id="userName" name="userName" value="@userName" class="form-control">
                @Html.ValidationMessage("userName")
            </div>
            <div class="form-group">
                <label for="password">Wachtwoord</label>
                <input type="password" id="password" name="password" value="@password" class="form-control">
                @Html.ValidationMessage("password")
            </div>
            <div class="form-group">
                <label for="confirmPassword">Bevestig wachtwoord</label>
                <input type="password" id="confirmPassword" name="confirmPassword" value="@confirmPassword" class="form-control">
                @Html.ValidationMessage("confirmPassword")
            </div>
            <div class="from-group" id="floatRight">
                <button type="submit" class="btn btn-success"><span class="glyphicon glyphicon-plus"></span>&nbsp; Toevoegen</button>
            </div>
        </fieldset>
    </form>
</div>