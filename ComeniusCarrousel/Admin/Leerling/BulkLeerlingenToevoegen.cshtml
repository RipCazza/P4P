@{
    Layout = "~/_Layout.cshtml";
    Page.Title = "Leerlingen toevoegen";

    if (!User.IsInRole("Admin"))
    {
        Response.Redirect("~/");
    }

    var leerlingenInvoer = "";

        /*var userName = "";
        var password = "";

        Validation.RequireField("userName", "U moet een gebruikersnaam invullen.");
        Validation.RequireField("password", "Er moet een wachtwoord ingevuld worden.");
        Validation.RequireField("confirmPassword", "Bevestegings wachtwoord mag niet leeg zijn.");
        Validation.Add("confirmPassword",
            Validator.EqualsTo("password", "Bevestegings wachtwoord komt niet overeen met het wachtwoord."));
        Validation.Add("password",
            Validator.StringLength(
                maxLength: Int32.MaxValue,
                minLength: 6,
                errorMessage: "Wachtwoord moet minstens 6 tekens bevatten"));
        Validation.Add("userName",
            Validator.StringLength(
                maxLength: 400,
                errorMessage: "Uw e mail kan niet meer dan 400 tekens bevatten"));*/

    if(IsPost)
    {
        leerlingenInvoer = Request.Form["leerlingInvoer"];
        List<string> leerlingen = new List<string>();
        leerlingen = Repository.SplitLeerlingen(leerlingenInvoer, leerlingen);
        foreach(string leerling in leerlingen)
        {
            
        }
        /*foreach(string leerling in leerlingen)
        {
            AntiForgery.Validate();
            userName = Request.Form["userName"];
            password = Request.Form["password"];
            confirmPassword = Request.Form["confirmPassword"];

            if(Validation.IsValid())
            {
                var db = Database.Open(App.AuthDataBase);

                var user = db.QuerySingle("SELECT UserName FROM UserProfile WHERE LOWER(UserName) = LOWER(@0)", userName);
                if(user == null)
                {
                    db.Execute("INSERT INTO UserProfile (UserName) VALUES (LOWER(@0))", userName);

                    try
                    {
                        var token = WebSecurity.CreateAccount(userName, password, false);
                        Roles.AddUserToRole(userName, "Leerling");
                        db.Close();
                        Response.Redirect("~/Admin/Leerling/LeerlingOverzicht");
                    }
                    catch(System.Web.Security.MembershipCreateUserException e)
                    {
                        db.Close();
                        ModelState.AddFormError(e.Message);
                    }
                }
                else
                {
                    ModelState.AddFormError("Gebruikersnaam bestaat al");
                }
                db.Close();
            }
        }*/
    }
}

<div class="col-md-12">
    <form method="post">
        @AntiForgery.GetHtml()
        @Html.ValidationSummary("Account creatie is mislukt, verhelp de fouten en probeer het opnieuw.", excludeFieldErrors: true, htmlAttributes: null)
        <textarea style="width: 100%; resize: none; margin: 0 5px; padding: 0px" name="leerlingenInvoer" class="form-control col-md-12" rows="20"
                  placeholder="Voornaam,Achternaam,Leerlingnummer,Mail,Wachtwoord,Klas,Niveau,Talentstroom vak,Instroomleerling(True/False)"
                  maxlength="4000"></textarea>

    </form>
</div>

